'use strict';var spell=angular.module('spell-module',['ngRoute']);spell.provider('moduleInvoker',function(){var self=this;self.providers=[],self.getProviders=function(a){for(var b=0;b<arguments.length;b++)'provider'in a[b]&&(self.providers.$provide=a[b]),'component'in arguments[b]&&(self.providers.$compileProvider=a[b]),'register'in arguments[b]&&(self.providers.$filterProvider=a[b]),'when'in arguments[b]&&(self.providers.$routeProvider=a[b]),'html5Mode'in arguments[b]&&(self.providers.$locationProvider=a[b])},self.$get=['$http','$route','$location','$history',function($http,$route,$location,$history){var providers=self.providers,that=this;return that.loadedModules=[],that.invokeModule=function(a){switch(console.log(a),a[1]){case'factory':providers.$provide.factory(a[2][0],a[2][1]);break;case'service':providers.$provide.service(a[2][0],a[2][1]);break;case'provider':providers.$provide.provider(a[2][0],a[2][1]);break;case'component':providers.$compileProvider.component(a[2][0],a[2][1]);break;case'directive':providers.$compileProvider.directive(a[2][0],a[2][1]);break;case'filter':providers.$filterProvider.register(a[2][0],a[2][1]);}},that.logModule=function(a){console.log('Module: ',a.name,'==>'),console.log(a)},{providers:self.providers,loadedModules:that.loadedModules,loadModule:function loadModule(path){$http({url:path,method:'GET',cache:!0,transformResponse:[]}).then(function(response){var module=eval(response.data);that.loadedModules[module.name+', '+module._invokeQueue[module._invokeQueue.length-1][2][0]]=module,that.invokeModule(module._invokeQueue.pop()),$route.reload(),$location.replace()}).catch(function(a){alert('Error loading module, '+a.status+' '+a.statusText+'. Redirecting...'),$history.removeLastEntry(),3>$history.getHistory().length?$location.path('/'):window.location='#!'+$history.getPreviousPage(),$location.replace()})}}}]}),spell.provider('$history',function(){var a=this;a.history=[],a.$get=function(){var b={historyMaintain:function historyMaintain(c){c.$on('$routeChangeSuccess',function(d,e){e&&e.$$route.originalPath!=b.getHistory()[b.getHistory().length-1]&&b.saveHistory(e.$$route.originalPath),b.logHistory()})},saveHistory:function saveHistory(c){a.history.push(c)},getPreviousPage:function getPreviousPage(){return a.history[a.history.length-1]},getHistory:function getHistory(){return a.history},logHistory:function logHistory(){console.log(a.history)},historySearch:function historySearch(c){var d=!1;a.history.forEach(function(e){e===c&&(d=!0)})},removeLastEntry:function removeLastEntry(){a.history=a.history.slice(0,a.history.length-1)}};return b}}),spell.factory('statesMaintain',['$location',function(){var b=[];return{maintainId:function maintainId(c,d){var e='';for(prop in d)e+='/'+d[prop];return console.log(e),c=c.replace(e,''),console.log(c),c},saveState:function saveState(c,d){b[c]=d},getState:function getState(c){return b[c]||void 0},removeState:function removeState(c){state[c]=void 0},getStatesArray:function getStatesArray(){return b},logStatesArray:function logStatesArray(){console.log(b)}}}]);